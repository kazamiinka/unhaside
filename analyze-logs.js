var logs = {"worklogData":[{"savecount":1,"logs":[],"_id":"5ade598bbce25004187a9bfc","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"var x = 0;","hash":"1b8fa7e0dfd06c9c6cbb053396c33ee1","createdAt":"2018-04-23T22:09:15.672Z","updatedAt":"2018-04-23T22:09:15.672Z","__v":0},{"savecount":2,"logs":[],"_id":"5ade5999bce25004187a9bfe","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"==x = 0;","hash":"022636ada1464aeb6c19459fbbf86efe","createdAt":"2018-04-23T22:09:29.114Z","updatedAt":"2018-04-23T22:09:29.114Z","__v":0},{"savecount":3,"logs":[],"_id":"5ade5c3ae9cac40ab342dfdf","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"-==x = 0;","hash":"8923ed9eeec91d3e73c9dfba8dbee7e2","createdAt":"2018-04-23T22:20:42.149Z","updatedAt":"2018-04-23T22:20:42.149Z","__v":0},{"savecount":4,"logs":[],"_id":"5ade5da2e9cac40ab342dfe2","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"x = 0;","hash":"3b63c5b266982feffb5779d46cdba7f1","createdAt":"2018-04-23T22:26:42.881Z","updatedAt":"2018-04-23T22:26:42.881Z","__v":0},{"savecount":5,"logs":[],"_id":"5ade5e60e9cac40ab342dfe4","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"-=-x = 0;","hash":"e00547cd1b2b4b09c59f507b11f940ff","createdAt":"2018-04-23T22:29:52.013Z","updatedAt":"2018-04-23T22:29:52.013Z","__v":0},{"savecount":-1,"logs":[{"type":"paste","text":"-=-x = 0;\n\nfunction fx() {\n    console.log(x);\n}","timestamp":1524527336546},{"type":"paste","text":"-=-x = 0;\n\nfunction fx() {\n    console.log(x);\n}","timestamp":1524527337983}],"_id":"5ade70eac1fc792941df6e3f","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","createdAt":"2018-04-23T23:48:58.611Z","updatedAt":"2018-04-23T23:48:58.611Z","__v":0},{"savecount":6,"logs":[],"_id":"5ade70f0c1fc792941df6e40","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        \n    </body>\n</html>","css":"","js":"-=-x = 0;\n\nfunction fx() {\n    console.log(x);\n}\n\n-=-x = 0;\n\nfunction fx() {\n    console.log(x);\n}\n\n-=-x = 0;\n\nfunction fx() {\n    console.log(x);\n}","hash":"bdb689cd3b74b3cd583215a9c951b8f2","createdAt":"2018-04-23T23:49:04.421Z","updatedAt":"2018-04-23T23:49:04.421Z","__v":0},{"savecount":7,"logs":[],"_id":"5ade7125c1fc792941df6e43","work":"5ade598bbce25004187a9bfb","clientIp":"::1","student":"5abcbb7e577ec6318e978c83","html":"<!DOCTYPE html>\n<html>\n    <head>\n        \n    </head>\n    <body>\n        <p onclick=\"fx(1)\">1</p>\n        <p onclick=\"fx(2)\">1</p>\n        \n    </body>\n</html>","css":"","js":"\n\nfunction fx(x) {\n    console.log(x);\n}\n\n","hash":"b57b2adc891c37d85d9d7d384f49cefa","createdAt":"2018-04-23T23:49:57.325Z","updatedAt":"2018-04-23T23:49:57.325Z","__v":0}],"runlogData":[{"logs":[[1524521836200,"domError",["Uncaught SyntaxError: Unexpected token ==","http://localhost:8080/run/work/5ade598bbce25004187a9bfb?time=1524521835779","10","1","SyntaxError: Unexpected token =="]]],"_id":"5ade5b6d062bef0974f797ee","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade5b6b062bef0974f797ed","hash":"022636ada1464aeb6c19459fbbf86efe"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T22:17:17.326Z","updatedAt":"2018-04-23T22:17:17.326Z","__v":0},{"logs":[[1524522044058,"domError",["Uncaught SyntaxError: Unexpected token -=","http://localhost:8080/run/work/5ade598bbce25004187a9bfb?time=1524522043883","12","1","SyntaxError: Unexpected token -="]]],"_id":"5ade5c3de9cac40ab342dfe1","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade5c3be9cac40ab342dfe0","hash":"8923ed9eeec91d3e73c9dfba8dbee7e2"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T22:20:45.097Z","updatedAt":"2018-04-23T22:20:45.097Z","__v":0},{"logs":[[1524522593242,"domError",["Uncaught SyntaxError: Unexpected token -=","http://localhost:8080/run/work/5ade598bbce25004187a9bfb?time=1524522593121","12","1","SyntaxError: Unexpected token -="]]],"_id":"5ade5e62e9cac40ab342dfe6","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade5e61e9cac40ab342dfe5","hash":"e00547cd1b2b4b09c59f507b11f940ff"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T22:29:54.287Z","updatedAt":"2018-04-23T22:29:54.287Z","__v":0},{"logs":[[1524527346481,"domError",["Uncaught SyntaxError: Unexpected token -=","http://localhost:8080/run/work/5ade598bbce25004187a9bfb?time=1524527346277","12","1","SyntaxError: Unexpected token -="]]],"_id":"5ade70f3c1fc792941df6e42","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade70f2c1fc792941df6e41","hash":"bdb689cd3b74b3cd583215a9c951b8f2"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T23:49:07.517Z","updatedAt":"2018-04-23T23:49:07.517Z","__v":0},{"logs":[[1524527401246,"element","<p onclick=\"fx(1)\">","start","click","fx","onclick",[1],"3,0,5,1",null,[]],[1524527401247,"log",[1],null,[]],[1524527401248,"element","<p onclick=\"fx(1)\">","end","click","fx","onclick",[1],"3,0,5,1",null,[]]],"_id":"5ade712bc1fc792941df6e45","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade7126c1fc792941df6e44","hash":"b57b2adc891c37d85d9d7d384f49cefa"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T23:50:03.266Z","updatedAt":"2018-04-23T23:50:03.266Z","__v":0},{"logs":[[1524527406070,"element","<p onclick=\"fx(1)\">","start","click","fx","onclick",[1],"3,0,5,1",null,[]],[1524527406070,"log",[1],null,[]],[1524527406071,"element","<p onclick=\"fx(1)\">","end","click","fx","onclick",[1],"3,0,5,1",null,[]],[1524527406600,"element","<p onclick=\"fx(2)\">","start","click","fx","onclick",[2],"3,0,5,1",null,[]],[1524527406600,"log",[2],null,[]],[1524527406600,"element","<p onclick=\"fx(2)\">","end","click","fx","onclick",[2],"3,0,5,1",null,[]]],"_id":"5ade712ec1fc792941df6e46","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade7126c1fc792941df6e44","hash":"b57b2adc891c37d85d9d7d384f49cefa"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T23:50:06.619Z","updatedAt":"2018-04-23T23:50:06.619Z","__v":0},{"logs":[[1524527407151,"element","<p onclick=\"fx(2)\">","start","click","fx","onclick",[2],"3,0,5,1",null,[]],[1524527407151,"log",[2],null,[]],[1524527407152,"element","<p onclick=\"fx(2)\">","end","click","fx","onclick",[2],"3,0,5,1",null,[]],[1524527408118,"element","<p onclick=\"fx(1)\">","start","click","fx","onclick",[1],"3,0,5,1",null,[]],[1524527408119,"log",[1],null,[]],[1524527408119,"element","<p onclick=\"fx(1)\">","end","click","fx","onclick",[1],"3,0,5,1",null,[]]],"_id":"5ade7130c1fc792941df6e47","student":"5abcbb7e577ec6318e978c83","clientIp":"::1","run":{"_id":"5ade7126c1fc792941df6e44","hash":"b57b2adc891c37d85d9d7d384f49cefa"},"work":"5ade598bbce25004187a9bfb","createdAt":"2018-04-23T23:50:08.134Z","updatedAt":"2018-04-23T23:50:08.134Z","__v":0}]}
var wl = logs['worklogData'];
var rl = logs['runlogData'];

worklogs = {
    data: {},
    initialized: false,
    init: function(wl) {
        wl.forEach((w) => this.add(w));
        this.initialized = true;
        return this.data;
    },
    add: function(w) {
        if (!this.data[w.student]) {
            this.data[w.student] = {};
        }
        if (!this.data[w.student][w.work]) {
            this.data[w.student][w.work] = [w];
        }
        else {
            this.data[w.student][w.work].push(w);
        }
        return w;
    }
};
wl = worklogs.init(wl);

/*
 split runlogs by studentid
 for each runlogs[studentid][workid], group by run and concatenate the logs
*/
runlogs = {
    data: {},
    initialized: false,
    init: function(rl) {
        rl.forEach((r) => this.add(r));
        this.initialized = true;
        return this.data;
    },
    add: function(r) {
        if (!this.data[r.student]) {
            this.data[r.student] = {};
        }
        if (!this.data[r.student][r.work]) {
            this.data[r.student][r.work] = [r];
        }
        else {
            var studentLog = this.data[r.student][r.work];
            if (studentLog[studentLog.length-1].run._id == r.run._id) {
                studentLog[studentLog.length-1].logs = studentLog[studentLog.length-1].logs.concat(r.logs);
            }
            else {
                studentLog.push(r);
            }
        }
        return r;
    }
};
rl = runlogs.init(rl);